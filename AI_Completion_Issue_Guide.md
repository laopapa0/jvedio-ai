# AI 补全功能问题排查指南

## 当前问题

**症状**：AI 补全成功！置信度：0%，所有信息都没有更新

**原因分析**：提示词要求 AI "只补全确实缺失的字段"和"如果无法确定某个字段值，返回null"，导致对于不出名的演员，AI 返回了全 null 的结果。

## 最新修复

### 1. 改进提示词

修改了提示词规则，让 AI 更积极地返回估算值：
- **原规则**：只补全确实缺失的字段，如果无法确定返回 null
- **新规则**：对于不出名的演员，请根据名字特征提供合理的估算值，至少尝试填充 3-5 个字段

### 2. 添加查看原始返回功能

在演员编辑窗口添加了 **"查看原始返回"** 按钮，可以查看 AI 返回的完整内容。

### 3. 增强日志记录

提升了日志级别，现在可以在日志中看到：
- 原始返回内容
- 提取的 JSON 内容
- 动态解析结果
- 字段统计

## 使用方法

### 步骤 1：重新编译和运行

1. 拉取最新代码
2. 重新编译项目
3. 运行应用程序

### 步骤 2：测试 AI 补全功能

1. 打开演员编辑窗口
2. 点击 **"AI 补全信息"** 按钮
3. 等待处理完成
4. 查看返回的消息

### 步骤 3：如果问题仍然存在

点击 **"查看原始返回"** 按钮，查看 AI 返回的原始内容。

### 步骤 4：查看日志

日志文件位置：`%AppData%\Jvedio\log\YYYY-MM-DD.log`

搜索关键词：
- `演员信息补全原始返回` - 查看原始返回
- `提取的JSON内容` - 查看提取的 JSON
- `动态解析结果` - 查看解析结果
- `字段统计` - 查看哪些字段有值

## 预期结果

### 情况 1：知名演员

对于知名女演员（如"三上悠亚"、"深田えいみ"等），AI 应该能够：
- 返回公开的生日、年龄、身高、三围等信息
- 置信度应该 > 50%
- 信息应该能够正确更新

### 情况 2：不出名演员

对于不出名的演员，AI 应该能够：
- 根据名字特征提供估算值（如身高范围、血型等）
- 至少填充 3-5 个字段
- 置信度应该 > 20%
- 提供参考信息而不是全部 null

### 情况 3：如果仍然返回全 null

如果 AI 仍然返回全 null，可能的原因：
1. **演员名字有问题**：名字可能不是真实存在的演员
2. **API 配置问题**：API Key 无效或网络问题
3. **模型限制**：模型拒绝提供猜测信息

此时请：
1. 查看原始返回内容
2. 查看 AI 的返回消息（reason 字段）
3. 检查日志中的错误信息
4. 尝试使用知名演员名字测试

## 下一步操作

### 1. 立即测试

使用知名演员名字测试，例如：
- 三上悠亚 (Yua Mikami)
- 深田えいみ (Eimi Fukada)
- 波多野結衣 (Yui Hatano)

如果这些演员能正常补全，说明功能是正常的，只是不出名的演员信息有限。

### 2. 提供原始返回内容

如果问题仍然存在，请：
1. 点击"查看原始返回"按钮
2. 复制原始返回内容
3. 提供演员名字
4. 提交 Issue 或反馈

### 3. 检查配置

确认：
- .env 文件配置正确
- API Key 有效
- 网络连接正常
- 使用的是付费 API（免费 API 可能有更多限制）

## 已知限制

1. **不出名的演员**：对于不出名的演员，AI 可能无法提供准确信息，只能提供估算值
2. **名字识别**：如果演员名字是化名或错误的名字，AI 无法找到对应信息
3. **API 限制**：免费 API 可能有内容过滤限制
4. **数据准确性**：AI 补全的信息仅供参考，建议人工核对

## 建议的改进方案（如果需要）

如果需要更准确的信息，可以考虑：
1. **提供照片**：让用户上传演员照片，使用图片+名字联合识别
2. **使用其他数据源**：集成其他演员信息数据库
3. **人工审核**：让用户确认 AI 提供的信息
4. **批量处理**：先测试知名演员，验证功能正常后再处理其他演员

---

**最后更新**：2026-01-31
**版本**：v1.0.2
