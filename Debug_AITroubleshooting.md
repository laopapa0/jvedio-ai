# AI 功能故障排查指南

## 问题：AI 补全成功！置信度：0%，所有信息都没有更新

### 快速诊断步骤

#### 1. 运行 AI 诊断工具

在主界面找到并打开 **"AI 诊断工具"**（如果菜单中没有，请在设置中添加此功能的入口），然后点击 **"运行诊断"**。

诊断工具会检查：
- ✅ API 配置是否正确
- ✅ API 是否可以正常调用
- ✅ JSON 解析是否正常
- ✅ .env 文件是否存在并配置正确

#### 2. 查看诊断结果

诊断结果会显示在窗口中，点击 **"复制结果"** 可以将结果复制到剪贴板。

#### 3. 根据诊断结果解决问题

### 常见问题和解决方案

#### 问题 1：诊断显示 "API 未配置"

**原因**：`.env` 文件不存在或未配置 API Key

**解决方案**：
1. 在应用程序目录下创建 `.env` 文件
2. 参考项目中的 `.env.example` 文件
3. 填入你的千问 API Key

示例 `.env` 文件：
```
DASHSCOPE_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxx
DASHSCOPE_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1
```

#### 问题 2：诊断显示 "API 调用失败"

**原因**：网络问题或 API Key 无效

**解决方案**：
1. 检查网络连接
2. 验证 API Key 是否有效
3. 确认 API Key 是否有足够的配额
4. 检查是否可以访问阿里云 API 服务

#### 问题 3：诊断显示 "JSON 解析失败"

**原因**：返回的数据格式不符合预期

**解决方案**：
1. 查看日志文件获取详细错误信息
2. 检查 AI 模型返回的原始内容
3. 可能需要调整提示词

#### 问题 4：诊断通过，但实际使用仍显示置信度 0%

**原因**：可能是以下原因之一：
- AI 返回的数据中所有字段都是 null
- 提示词需要优化
- 演员信息已经很完整，不需要补全

**解决方案**：
1. 查看日志文件中的 "演员信息补全原始返回"
2. 检查返回的 JSON 内容
3. 尝试使用不同的演员名字进行测试

### 查看详细日志

日志文件位置：
```
%AppData%\Jvedio\log\YYYY-MM-DD.log
```

Windows 快捷方式：
1. 按 `Win + R`
2. 输入 `%AppData%\Jvedio\log\`
3. 回车

关键日志搜索：
- `演员信息补全原始返回` - 查看 AI 返回的原始内容
- `动态解析结果` - 查看解析后的数据结构
- `字段统计` - 查看哪些字段有值
- `JSON反序列化异常` - 查看解析错误
- `千问API配置加载成功` - 查看 API 配置状态

### 手动测试 API

你可以使用诊断工具中的 **"API 配置测试"** 功能来验证 API 是否正常工作。

测试内容：
- 发送简单的测试请求到千问 API
- 检查是否能收到响应
- 验证 API Key 是否有效

### 获取帮助

如果以上步骤都无法解决问题，请：

1. 运行诊断工具并复制完整结果
2. 收集日志文件中的相关错误信息
3. 在 GitHub 上提交 Issue
4. 附上诊断结果和日志内容

### 下一步

运行诊断工具后，请按照诊断结果中的建议进行操作。如果所有测试都通过但问题仍然存在，请提供：

- 诊断工具的完整输出
- 日志文件中的相关片段
- 你正在测试的演员名字
- 使用的 API Key 类型（免费/付费）

这样我们可以更好地帮助你解决问题。
